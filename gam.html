<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
Â  <title>Car Obstacle Game - Extreme Mode</title>
Â  <link rel="stylesheet" href="style.css">
Â  <style>
Â  Â  body {
Â  Â  Â  overflow: hidden;
Â  Â  }
Â  Â  #player {
Â  Â  Â  position: absolute;
Â  Â  Â  width: 50px;
Â  Â  Â  height: 50px;
Â  Â  Â  background-color: red;
Â  Â  Â  left: 600px;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
Â  Â  }
Â  Â  .obstacle {
Â  Â  Â  position: absolute;
Â  Â  Â  width: 50px;
Â  Â  Â  height: 50px;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  box-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
Â  Â  }
Â  Â  .normal { background-color: greenyellow; }
Â  Â  .fast { background-color: orange; }
Â  Â  .bouncing { background-color: whitesmoke; }
Â  Â  .reverse { background-color: deeppink; }

Â  Â  #scoreDisplay {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 10px;
Â  Â  Â  left: 700px;
Â  Â  Â  color: goldenrod;
Â  Â  Â  font-family: 'Arial', sans-serif;
Â  Â  Â  font-size: 20px;
Â  Â  Â  font-weight: bold;
Â  Â  Â  background: rgba(0, 0, 0, 0.5);
Â  Â  Â  padding: 10px;
Â  Â  Â  border-radius: 10px;
Â  Â  }

Â  Â  #leaderboard {
Â  Â  Â  display: none;
Â  Â  Â  position: absolute;
Â  Â  Â  top: 100px;
Â  Â  Â  left: 50%;
Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  background:black;
Â  Â  Â  padding: 20px;
Â  Â  Â  border-radius: 15px;
Â  Â  Â  box-shadow: 0 0 15px rgba(0,0,0,0.5);
Â  Â  Â  z-index: 9999;
Â  Â  }

Â  Â  #leaderboard table {
Â  Â  Â  border-collapse: collapse;
Â  Â  Â  width: 100%;
Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  }

Â  Â  #leaderboard th, #leaderboard td {
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  padding: 8px 12px;
Â  Â  Â  text-align: center;
Â  Â  }

Â  Â  #showLeaderboard {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 10px;
Â  Â  Â  right: 30px;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  background: navy;
Â  Â  Â  color: red;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  .mobile-control {
Â  Â  Â  position: fixed;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 50%;
Â  Â  Â  z-index: 999;
Â  Â  }
Â  Â  #up-control {
Â  Â  Â  top: 0;
Â  Â  }
Â  Â  #down-control {
Â  Â  Â  bottom: 0;
Â  Â  }
Â  </style>
</head>
<body id="lk">
Â  <marquee class="marq" bgcolor="Green" direction="left" loop="">
Â  Â  <div class="geek1">Press arrowup and arrowdown key to move! HOPE YOU LOVED THE GAME.VISIT AGAIN!</div>
Â  </marquee>

Â  <audio id="bgMusic" src="victory-awaits-in-the-gaming-universe_astronaut-265184.mpop3" loop autoplay></audio>
Â  <audio id="coinSound" src="coin.wav"></audio>
Â  <audio id="crashSound" src="crash.wav"></audio>

Â  <div id="player"></div>
Â  <div id="scoreDisplay">Score: 0 | Lives: 3</div>
Â  <button id="showLeaderboard">Show Leaderboard</button>

Â  <div id="leaderboard">
Â  Â  <h3>Top Players</h3>
Â  Â  <table>
Â  Â  Â  <thead>
Â  Â  Â  Â  <tr><th>Username</th><th>Highest Score</th></tr>
Â  Â  Â  </thead>
Â  Â  Â  <tbody id="leaderboardBody"></tbody>
Â  Â  </table>
Â  </div>

Â  Â  <div id="up-control" class="mobile-control"></div>
Â  <div id="down-control" class="mobile-control"></div>

Â  <script>
Â  Â  let gameRunning = true;
Â  Â  class Stack {
Â  Â  Â  constructor() { this.items = []; }
Â  Â  Â  push(item) { this.items.push(item); }
Â  Â  Â  pop() { return this.items.pop(); }
Â  Â  }

Â  Â  class Node {
Â  Â  Â  constructor(data) { this.data = data; this.next = null; }
Â  Â  }

Â  Â  class LinkedList {
Â  Â  Â  constructor() { this.head = null; }
Â  Â  Â  add(data) {
Â  Â  Â  Â  const newNode = new Node(data);
Â  Â  Â  Â  if (!this.head) this.head = newNode;
Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  let current = this.head;
Â  Â  Â  Â  Â  while (current.next) current = current.next;
Â  Â  Â  Â  Â  current.next = newNode;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }

Â  Â  class TreeNode {
Â  Â  Â  constructor(score) { this.score = score; this.left = null; this.right = null; }
Â  Â  }

Â  Â  class BinaryTree {
Â  Â  Â  constructor() { this.root = null; }
Â  Â  Â  insert(score) {
Â  Â  Â  Â  const newNode = new TreeNode(score);
Â  Â  Â  Â  if (!this.root) this.root = newNode;
Â  Â  Â  Â  else this.#insertNode(this.root, newNode);
Â  Â  Â  }
Â  Â  Â  #insertNode(node, newNode) {
Â  Â  Â  Â  if (newNode.score < node.score) node.left ? this.#insertNode(node.left, newNode) : node.left = newNode;
Â  Â  Â  Â  else node.right ? this.#insertNode(node.right, newNode) : node.right = newNode;
Â  Â  Â  }
Â  Â  Â  findMax(node = this.root) { return node?.right ? this.findMax(node.right) : node?.score ?? 0; }
Â  Â  }

Â  Â  const lanes = [100, 220, 340, 460];
Â  Â  let currentLane = 1;
Â  Â  const player = document.getElementById("player");
Â  Â  let playerY = lanes[currentLane];
Â  Â  player.style.top = `${playerY}px`;

Â  Â  const scoreStack = new Stack();
Â  Â  const obstacleList = new LinkedList();
Â  Â  const highScoreTree = new BinaryTree();
Â  Â  let score = 0, lives = 3;

Â  Â  const coinSound = document.getElementById("coinSound");
Â  Â  const crashSound = document.getElementById("crashSound");

Â  Â  document.addEventListener("keydown", (e) => {
Â  Â  Â  if (e.key === "ArrowUp" && currentLane > 0) currentLane--;
Â  Â  Â  if (e.key === "ArrowDown" && currentLane < lanes.length - 1) currentLane++;
Â  Â  Â  playerY = lanes[currentLane];
Â  Â  Â  player.style.top = `${playerY}px`;
Â  Â  });
    
    // Add event listeners for touch controls
    document.getElementById("up-control").addEventListener("touchstart", (e) => {
      e.preventDefault();
      if (currentLane > 0) {
        currentLane--;
        playerY = lanes[currentLane];
        player.style.top = `${playerY}px`;
      }
    });

    document.getElementById("down-control").addEventListener("touchstart", (e) => {
      e.preventDefault();
      if (currentLane < lanes.length - 1) {
        currentLane++;
        playerY = lanes[currentLane];
        player.style.top = `${playerY}px`;
      }
    });

Â  Â  function updateScore() {
Â  Â  Â  score += 5;
Â  Â  Â  scoreStack.push(score);
Â  Â  Â  coinSound.currentTime = 0;
Â  Â  Â  coinSound.play();
Â  Â  }

Â  Â  function handleCollision() {
Â  crashSound.currentTime = 0;
Â  crashSound.play();
Â  if (lives > 0) lives--;
Â  if (lives <= 0) {
Â  Â  const username = localStorage.getItem("username") || "Guest";
Â  Â  const finalScore = scoreStack.pop() || 0;

Â  Â  fetch("save_score.php", {
Â  Â  Â  method: "POST",
Â  Â  Â  headers: { "Content-Type": "application/json" },
Â  Â  Â  body: JSON.stringify({ username: username, score: finalScore })
Â  Â  })
Â  Â  .then(res => res.json())
Â  Â  .then(data => {
Â  Â  Â  updateLeaderboard();
Â  Â  Â  setTimeout(() => {
Â  alert(`Game Over! Highest Score for ${username}: ${data.highest}`);
Â  gameRunning = false; // ðŸ”´ Stop the loop
Â  document.getElementById("gameOverOptions").style.display = "block";
}, 300);
Â  Â  })
Â  Â  .catch(err => {
Â  Â  Â  console.error("Score save error:", err);
Â  Â  Â  alert("Game Over! But couldn't fetch highest score.");
gameRunning = false;
document.getElementById("bgMusic").pause();
document.getElementById("gameOverOptions").style.display = "block";
Â  Â  });
Â  }
}


Â  Â  function createObstacle() {
Â  Â  Â  const types = [
Â  Â  Â  Â  { type: "normal", speed: 3, bounce: false, reverse: false },
Â  Â  Â  Â  { type: "fast", speed: 10, bounce: false, reverse: false },
Â  Â  Â  Â  { type: "bouncing", speed: 5, bounce: true, reverse: false },
Â  Â  Â  Â  { type: "reverse", speed: 12, bounce: false, reverse: true },
Â  Â  Â  ];
Â  Â  Â  const obstacleData = types[Math.floor(Math.random() * types.length)];
Â  Â  Â  const obstacle = {
Â  Â  Â  Â  x: obstacleData.reverse ? -60 : window.innerWidth,
Â  Â  Â  Â  y: lanes[Math.floor(Math.random() * lanes.length)],
Â  Â  Â  Â  speed: obstacleData.speed,
Â  Â  Â  Â  type: obstacleData.type,
Â  Â  Â  Â  bounce: obstacleData.bounce,
Â  Â  Â  Â  reverse: obstacleData.reverse,
Â  Â  Â  Â  dy: obstacleData.bounce ? 3 : 0,
Â  Â  Â  Â  width: 50, height: 50,
Â  Â  Â  Â  div: document.createElement("div")
Â  Â  Â  };

Â  Â  Â  obstacle.div.className = `obstacle ${obstacle.type}`;
Â  Â  Â  obstacle.div.style.left = `${obstacle.x}px`;
Â  Â  Â  obstacle.div.style.top = `${obstacle.y}px`;
Â  Â  Â  document.body.appendChild(obstacle.div);
Â  Â  Â  obstacleList.add(obstacle);
Â  Â  }

Â  Â  function moveObstacles(playerRect) {
Â  Â  Â  let current = obstacleList.head;
Â  Â  Â  let prev = null;

Â  Â  Â  while (current) {
Â  Â  Â  Â  let obstacle = current.data;
Â  Â  Â  Â  if (obstacle.reverse) obstacle.x += obstacle.speed;
Â  Â  Â  Â  else obstacle.x -= obstacle.speed;

Â  Â  Â  Â  if (obstacle.bounce) {
Â  Â  Â  Â  Â  obstacle.y += obstacle.dy;
Â  Â  Â  Â  Â  if (obstacle.y <= 0 || obstacle.y >= window.innerHeight - obstacle.height) {
Â  Â  Â  Â  Â  Â  obstacle.dy *= -1;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  obstacle.div.style.left = `${obstacle.x}px`;
Â  Â  Â  Â  obstacle.div.style.top = `${obstacle.y}px`;

Â  Â  Â  Â  if (
Â  Â  Â  Â  Â  playerRect.left < obstacle.x + 50 &&
Â  Â  Â  Â  Â  playerRect.right > obstacle.x &&
Â  Â  Â  Â  Â  playerRect.top < obstacle.y + 50 &&
Â  Â  Â  Â  Â  playerRect.bottom > obstacle.y
Â  Â  Â  Â  ) {
Â  Â  Â  Â  Â  handleCollision();
Â  Â  Â  Â  Â  obstacle.div.remove();
Â  Â  Â  Â  Â  if (prev) prev.next = current.next;
Â  Â  Â  Â  Â  else obstacleList.head = current.next;
Â  Â  Â  Â  } else if ((obstacle.reverse && obstacle.x > window.innerWidth + 60) || (!obstacle.reverse && obstacle.x < -60)) {
Â  Â  Â  Â  Â  updateScore();
Â  Â  Â  Â  Â  obstacle.div.remove();
Â  Â  Â  Â  Â  if (prev) prev.next = current.next;
Â  Â  Â  Â  Â  else obstacleList.head = current.next;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  prev = current;
Â  Â  Â  Â  }
Â  Â  Â  Â  current = current.next;
Â  Â  Â  }
Â  Â  }

Â  Â  function updateLeaderboard() {
Â  Â  Â  fetch("leaderboard.php")
Â  Â  Â  Â  .then(res => res.json())
Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  const tableBody = document.getElementById("leaderboardBody");
Â  Â  Â  Â  Â  tableBody.innerHTML = "";
Â  Â  Â  Â  Â  data.forEach(entry => {
Â  Â  Â  Â  Â  Â  const row = document.createElement("tr");
Â  Â  Â  Â  Â  Â  row.innerHTML = `<td>${entry.username}</td><td>${entry.highest}</td>`;
Â  Â  Â  Â  Â  Â  tableBody.appendChild(row);
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  document.getElementById("leaderboard").style.display = "block";
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(err => console.error("Error loading leaderboard:", err));
Â  Â  }

Â  Â  const button = document.getElementById("showLeaderboard");
const leaderboard = document.getElementById("leaderboard");

button.addEventListener("click", () => {
Â  if (leaderboard.style.display === "block") {
Â  Â  leaderboard.style.display = "none";
Â  Â  button.textContent = "Show Leaderboard";
Â  } else {
Â  Â  updateLeaderboard(); // Load and show
Â  Â  button.textContent = "Hide Leaderboard";
Â  }
});

function gameLoop() {
Â  if (!gameRunning) return; // ðŸ”´ Stop loop if game is over

Â  const playerRect = player.getBoundingClientRect();
Â  moveObstacles(playerRect);
Â  document.getElementById("scoreDisplay").innerHTML = `Score: ${score} | Lives: ${lives}`;
Â  requestAnimationFrame(gameLoop);
}


Â  Â  setInterval(createObstacle, 500);
Â  Â  gameLoop();

Â  Â  // This is a placeholder for the platform's rewarded ad SDK.
// You will replace this with Poki, Lagged, or another platform's specific code.
function showRewardedAd(onComplete, onFailed) {
Â  console.log("Ad request initiated...");
Â  // In a real game, you would call a function like Poki.SDK.showRewardedAd().
Â  // For this example, we simulate a successful ad after 2 seconds.
Â  setTimeout(() => {
Â  Â  console.log("Ad completed successfully!");
Â  Â  onComplete(true);
Â  }, 2000);
}

// Function to handle the player's reward.
// You can customize the reward (e.g., add points, coins, etc.).
function handleReward() {
Â  lives = 3;
Â  score = score;
Â  gameRunning = true;
Â  document.getElementById("gameOverOptions").style.display = "none";
Â  gameLoop();
Â  console.log("Player rewarded! Lives restored.");
}

// Function called when the 'Revive with Ad' button is clicked.
function reviveWithAd() {
Â  showRewardedAd(
Â  Â  (success) => {
Â  Â  Â  if (success) {
Â  Â  Â  Â  handleReward();
Â  Â  Â  } else {
Â  Â  Â  Â  alert("Ad failed to load. Please try again.");
Â  Â  Â  }
Â  Â  },
Â  Â  () => {
Â  Â  Â  alert("Ad could not be loaded. Please try again.");
Â  Â  }
Â  );
}

// Update your existing collision logic to show the ad option.
function gameOver() {
Â  gameRunning = false;
Â  document.getElementById("gameOverOptions").style.display = "block";
}
Â  </script>
Â  <div id="gameOverOptions" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
Â  background:#222; padding:30px; border-radius:15px; box-shadow:0 0 20px rgba(0,0,0,0.7); text-align:center; z-index:10000;">
Â  <h2 style="color:white; margin-bottom:20px;">Game Over!</h2>
Â  <button onclick="reviveWithAd()" style="padding:10px 20px; margin: 10px; font-size: 16px; cursor: pointer; border-radius: 5px; background-color: #4CAF50; color: white; border: none;">Watch Ad for a Revive!</button>
Â  <button onclick="location.reload()" style="padding:10px 20px; margin-right:20px; background:limegreen; border:none; border-radius:8px; color:white; font-size:16px; cursor:pointer;">
Â  Â  Restart
Â  </button>
Â  <a href="s2.html" style="padding:10px 20px; background:crimson; border:none; border-radius:8px; color:white; font-size:16px; text-decoration:none;">
Â  Â  Quit
Â  </a>
</div>
</body>
</html>
